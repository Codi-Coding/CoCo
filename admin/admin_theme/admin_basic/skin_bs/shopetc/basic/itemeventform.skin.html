<?php if (!defined('_GNUBOARD_')) exit;
add_stylesheet('<link rel="stylesheet" href="../../../plugins/magnific-popup/magnific-popup.min.css" type="text/css" media="screen">',0);
?>

<style>
.admin-shop-itemeventform .input-fake {padding:4px 10px;border:1px solid #d5d5d5}
.admin-shop-itemeventform .thumbnail-gallery {max-width:200px}
.admin-shop-itemeventform .srel_list {border:1px solid #d5d5d5;background:#f5f5f5;padding:10px;min-height:300px}
.admin-shop-itemeventform .srel_pad {min-height:34px}
</style>

<div class="admin-shop-itemeventform">
	<form name="feventform" method="post" action="{_action_url}" onsubmit="return check_form(this);" enctype="multipart/form-data" class="eyoom-form">
	<input type="hidden" name="w" value="{_w}">
	<input type="hidden" name="ev_id" value="{_ev_id}">
	<input type="hidden" name="ev_item" value="">

	<div class="headline">
		<h4><strong>이벤트관리 {? _w==''}입력{: _w=='u'}수정{/}</strong></h4>
		<a href="{C.EYOOM_ADMIN_URL}/?dir=shopetc&pid=itemevent" class="btn-e btn-e-xs btn-e-purple pull-right"><i class="fa fa-list"></i> 이벤트목록</a>
		<div class="clearfix"></div>
	</div>
	<div class="margin-bottom-30"></div>

	<div id="admin-form">
		<div class="adm-form-wrap margin-bottom-30">
			<header>
				<strong><i class="fa fa-caret-right"></i> 설정관리</strong>
			</header>

			<!--{? _w=='u'}-->
			<fieldset>
				<div class="row">
					<div class="col col-3">
						<div class="input-fake">
							{_ev_id}
						</div>
					</div>
					<div class="col col-3">
						<a href="{C.G5_SHOP_URL}/event.php?ev_id={ev.ev_id}" class="btn-e btn-e-yellow">이벤트바로가기</a>
					</div>
				</div>
			</fieldset>
			<!--{/}-->

			<fieldset>
				<div class="row">
					<div class="col col-6">
						<div class="row">
							<div class="col col-6">
								<section>
									<label for="ev_skin" class="label">출력스킨</label>
					                <label class="select">
					                	<select name="ev_skin" id="ev_skin">
						                	{=get_list_skin_options("^list.[0-9]+\.skin\.php", C.G5_SHOP_SKIN_PATH, ev.ev_skin)}
					                	</select><i></i>
					                </label>
								</section>
							</div>
						</div>
						<div class="note margin-bottom-10">
			                <strong>Note:</strong> 기본으로 제공하는 스킨은 {=str_replace(C.G5_PATH+'/', '', C.G5_SHOP_SKIN_PATH)}/list.*.skin.php 입니다.<br>{C.G5_SHOP_DIR}/event.php?ev_id=1234567890&amp;skin=userskin.php 처럼 직접 만든 스킨을 사용할 수도 있습니다.
			            </div>
					</div>
					<div class="col col-6">
						<div class="row">
							<div class="col col-6">
								<section>
									<label for="ev_mobile_skin" class="label">모바일 출력스킨</label>
					                <label class="select">
					                	<select name="ev_mobile_skin" id="ev_mobile_skin">
						                	{=get_list_skin_options("^list.[0-9]+\.skin\.php", C.G5_MSHOP_SKIN_PATH, ev.ev_mobile_skin)}
					                	</select><i></i>
					                </label>
								</section>
							</div>
						</div>
						<div class="note margin-bottom-10">
			                <strong>Note:</strong> 기본으로 제공하는 스킨은 {=str_replace(C.G5_PATH+'/', '', C.G5_MSHOP_SKIN_PATH)}/list.*.skin.php 입니다.<br>{C.G5_SHOP_DIR}/event.php?ev_id=1234567890&amp;skin=userskin.php 처럼 직접 만든 스킨을 사용할 수도 있습니다.
			            </div>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-3">
						<section>
							<label for="ev_img_width" class="label">출력이미지 폭</label>
			                <label class="input">
			                	<i class="icon-append">px</i>
			                	<input type="text" name="ev_img_width" value="{ev.ev_img_width}" id="ev_img_width" required>
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_img_height" class="label">출력이미지 높이</label>
			                <label class="input">
			                	<i class="icon-append">px</i>
			                	<input type="text" name="ev_img_height" value="{ev.ev_img_height}" id="ev_img_height" required>
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_list_mod" class="label">1줄당 이미지 수</label>
			                <label class="input">
			                	<i class="icon-append">개</i>
			                	<input type="text" name="ev_list_mod" value="{ev.ev_list_mod}" id="ev_list_mod" required>
			                </label>
			                <div class="note margin-bottom-10">
				                <strong>Note:</strong> 1행에 설정한 값만큼의 상품을 출력합니다. 스킨 설정에 따라 1행에 하나의 상품만 출력할 수도 있습니다.
			            	</div>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_list_row" class="label">이미지 줄 수</label>
			                <label class="input">
			                	<i class="icon-append">줄</i>
			                	<input type="text" name="ev_list_row" value="{ev.ev_list_row}" id="ev_list_row" required>
			                </label>
			                <div class="note margin-bottom-10">
				                <strong>Note:</strong> 한 페이지에 출력할 이미지 줄 수를 설정합니다. 한 페이지에 표시되는 상품수는 (1줄당 이미지 수 x 줄 수) 입니다.
			            	</div>
						</section>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-3">
						<section>
							<label for="ev_mobile_img_width" class="label">모바일 출력이미지 폭</label>
			                <label class="input">
			                	<i class="icon-append">px</i>
			                	<input type="text" name="ev_mobile_img_width" value="{ev.ev_mobile_img_width}" id="ev_mobile_img_width" required>
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_mobile_img_height" class="label">모바일 출력이미지 높이</label>
			                <label class="input">
			                	<i class="icon-append">px</i>
			                	<input type="text" name="ev_mobile_img_height" value="{ev.ev_mobile_img_height}" id="ev_mobile_img_height" required>
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_mobile_list_mod" class="label">모바일 1줄당 이미지 수</label>
			                <label class="input">
			                	<i class="icon-append">개</i>
			                	<input type="text" name="ev_mobile_list_mod" value="{ev.ev_mobile_list_mod}" id="ev_mobile_list_mod" required>
			                </label>
			                <div class="note margin-bottom-10">
				                <strong>Note:</strong> 1행에 설정한 값만큼의 상품을 출력합니다. 스킨 설정에 따라 1행에 하나의 상품만 출력할 수도 있습니다.
			            	</div>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_mobile_list_row" class="label">모바일 이미지 줄 수</label>
			                <label class="input">
			                	<i class="icon-append">줄</i>
			                	<input type="text" name="ev_mobile_list_row" value="{ev.ev_mobile_list_row}" id="ev_mobile_list_row" required>
			                </label>
			                <div class="note margin-bottom-10">
				                <strong>Note:</strong> 한 페이지에 출력할 이미지 줄 수를 설정합니다. 한 페이지에 표시되는 상품수는 (1줄당 이미지 수 x 줄 수) 입니다.
			            	</div>
						</section>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-6">
						<section>
							<label for="ev_subject" class="label">이벤트제목</label>
			                <label class="input">
			                	<input type="text" name="ev_subject" value="{=htmlspecialchars2(ev.ev_subject)}" id="ev_subject" required>
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_subject_strong" class="label">제목 강조 여부</label>
			                <label class="checkbox">
			                	<input type="checkbox" name="ev_subject_strong" value="1" id="ev_subject_strong" {? ev.ev_subject_strong}checked{/}><i></i> 강조하기
			                </label>
						</section>
					</div>
					<div class="col col-3">
						<section>
							<label for="ev_use" class="label">사용</label>
			                <label class="select">
								<select name="ev_use" id="ev_use">
					                <option value="1" {=get_selected(ev.ev_use, 1)}>사용</option>
					                <option value="0" {=get_selected(ev.ev_use, 0)}>사용안함</option>
					            </select><i></i>
			                </label>
						</section>
						<div class="note margin-bottom-10">
			                <strong>Note:</strong> 사용하지 않으면 레이아웃의 이벤트 메뉴 및 이벤트 관련 페이지에 접근할 수 없습니다.
		            	</div>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-6">
						<section>
							<label for="ev_mimg" class="label">배너이미지</label>
					        <label for="file" class="input input-file">
								<div class="button bg-color-light-grey"><input type="file" id="ev_mimg" name="ev_mimg" value="이미지선택" onchange="this.parentNode.nextSibling.value = this.value">이미지선택</div><input type="text" readonly>
							</label>
							<!--{? _mimg_url}-->
							<label for="ev_mimg_del" class="checkbox"><input type="checkbox" name="ev_mimg_del" value="1" id="ev_mimg_del"><i></i> 삭제</label>
							<div class="thumbnail-gallery">
								<div class="thumbnail">
									<div class="thumb">
										<img src="{_mimg_url}" class="img-responsive">
										<div class="caption-overflow">
											<span>
												<a href="{_mimg_url}" class="btn-e btn-e-default btn-e-lg btn-e-brd"><i class="fa fa-plus color-white"></i></a>
											</span>
										</div>
									</div>
								</div>
							</div>
							<!--{/}-->
						</section>
						<div class="note margin-bottom-10">
			                <strong>Note:</strong> 쇼핑몰 레이아웃에서 글자 대신 이미지로 출력할 경우 사용합니다.
		            	</div>
					</div>
				</div>
			</fieldset>
		</div>
	</div>

	<div class="text-center margin-top-30 margin-bottom-30">
		<input type="submit" value="확인" id="btn_submit" class="btn-e btn-e-lg btn-e-red" accesskey="s">
		<a href="{C.EYOOM_ADMIN_URL}/?dir=shopetc&amp;pid=itemevent" class="btn-e btn-e-lg btn-e-dark">목록</a>
	</div>

	<div id="admin-form">
		<div class="adm-form-wrap margin-bottom-30">
			<header>
				<strong><i class="fa fa-caret-right"></i> 관련상품 및 디자인</strong>
			</header>

			<fieldset>
				<div class="row">
					<div class="col col-6">
						<section>
							<label for="ev_skin" class="label">상품검색</label>
							<div class="row">
								<div class="col col-6">
									<section>
										<label class="select">
						                    <select name="ca_id" id="sch_ca_id">
						                        <option value="">분류선택</option>
						                        {_category_select}
						                    </select><i></i>
										</label>
									</section>
								</div>
								<div class="col col-6">
									<section>
										<div class="input input-button">
											<input type="text" name="sch_name" id="sch_name" placeholder="상품명">
											<div class="button"><input type="button" id="btn_search_item"><i class="fa fa-search"></i> 검색</div>
										</div>
									</section>
								</div>
							</div>
			                <div id="sch_item_list" class="srel_list">
			                    <p>상품의 분류를 선택하시거나 상품명을 입력하신 후 검색하여 주십시오.</p>
			                </div>
						</section>
					</div>
					<div class="col col-6">
						<section>
							<label for="ev_mobile_skin" class="label">등록된 상품</label>
							<div class="srel_pad"></div>
							<div id="reg_item_list" class="srel_sel srel_list">
								<ul>
					                <!--{@ it_info}-->
			                        <li>
			                            <input type="hidden" name="it_id[]" value="{.it_id}">
			                            <div>{.image} {.it_name}</div>
			                            <div class="list_item_btn"><button type="button" class="del_item btn-e btn-e-xs btn-e-dark">삭제</button></div>
			                        </li>
					                <!--{/}-->
				                </ul>
				                <!--{? it_info.size_ == 0}-->
				                <div>
				                    <p>등록된 상품이 없습니다.</p>
				                </div>
				                <!--{/}-->
							</div>
						</section>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-6">
						<section>
							<label for="ev_mimg" class="label">상단이미지</label>
					        <label for="file" class="input input-file">
								<div class="button bg-color-light-grey"><input type="file" id="ev_himg" name="ev_himg" value="이미지선택" onchange="this.parentNode.nextSibling.value = this.value">이미지선택</div><input type="text" readonly>
							</label>
							<!--{? _himg_url}-->
							<label for="ev_himg_del" class="checkbox"><input type="checkbox" name="ev_himg_del" value="1" id="ev_himg_del"><i></i> 삭제</label>
							<div class="thumbnail-gallery">
								<div class="thumbnail">
									<div class="thumb">
										<img src="{_himg_url}" class="img-responsive">
										<div class="caption-overflow">
											<span>
												<a href="{_himg_url}" class="btn-e btn-e-default btn-e-lg btn-e-brd"><i class="fa fa-plus color-white"></i></a>
											</span>
										</div>
									</div>
								</div>
							</div>
							<!--{/}-->
						</section>
						<section>
							<div class="note margin-bottom-10">
				                <strong>Note:</strong> 이벤트 페이지 상단에 업로드 한 이미지를 출력합니다.
			            	</div>
						</section>
					</div>
					<div class="col col-6">
						<section>
							<label for="ev_timg" class="label">하단이미지</label>
					        <label for="file" class="input input-file">
								<div class="button bg-color-light-grey"><input type="file" id="ev_timg" name="ev_timg" value="이미지선택" onchange="this.parentNode.nextSibling.value = this.value">이미지선택</div><input type="text" readonly>
							</label>
							<!--{? _himg_url}-->
							<label for="ev_timg_del" class="checkbox"><input type="checkbox" name="ev_timg_del" value="1" id="ev_timg_del"><i></i> 삭제</label>
							<div class="thumbnail-gallery">
								<div class="thumbnail">
									<div class="thumb">
										<img src="{_timg_url}" class="img-responsive">
										<div class="caption-overflow">
											<span>
												<a href="{_timg_url}" class="btn-e btn-e-default btn-e-lg btn-e-brd"><i class="fa fa-plus color-white"></i></a>
											</span>
										</div>
									</div>
								</div>
							</div>
							<!--{/}-->
						</section>
						<section>
							<div class="note margin-bottom-10">
				                <strong>Note:</strong> 이벤트 페이지 하단에 업로드 한 이미지를 출력합니다.
			            	</div>
						</section>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-12">
						<section>
							<label for="ev_head_html" class="label">상단내용</label>
					        {=editor_html("ev_head_html", get_text(ev.ev_head_html, 0))}
						</section>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<div class="row">
					<div class="col col-12">
						<section>
							<label for="ev_tail_html" class="label">하단내용</label>
					        {=editor_html("ev_tail_html", get_text(ev.ev_tail_html, 0))}
						</section>
					</div>
				</div>
			</fieldset>
		</div>

	</div>

	<div class="text-center margin-top-30 margin-bottom-30">
		<input type="submit" value="확인" id="btn_submit" class="btn-e btn-e-lg btn-e-red" accesskey="s">
		<a href="{C.EYOOM_ADMIN_URL}/?dir=shopetc&amp;pid=itemevent" class="btn-e btn-e-lg btn-e-dark">목록</a>
	</div>

	</form>
</div>

<script src="../../../plugins/magnific-popup/magnific-popup.min.js"></script>
<script>
$(document).ready(function() {
	$('.thumbnail-gallery').magnificPopup({
		delegate: 'a',
		type: 'image',
		tLoading: '로딩중...',
		mainClass: 'mfp-img-mobile',
		image: {
			tError: '이미지를 불러올수 없습니다.',
			titleSrc: function(item) {
				return item.el.attr('title');
			}
		}
	});
});
	
$(function() {
    $("#btn_search_item").click(function() {
        var ca_id = $("#sch_ca_id").val();
        var it_name = $.trim($("#sch_name").val());

        if(ca_id == "" && it_name == "") {
            $("#sch_item_list").html("<p>상품의 분류를 선택하시거나 상품명을 입력하신 후 검색하여 주십시오.</p>");
            return false;
        }

        $("#sch_item_list").load(
            "{C.G5_ADMIN_URL}/shop_admin/itemeventsearch.php",
            { w: "{_w}", ev_id: "{_ev_id}", ca_id: ca_id, it_name: it_name }
        );
    });

    $(document).on("click", "#sch_item_list .add_item", function() {
        // 이미 등록된 상품인지 체크
        var $li = $(this).closest("li");
        var it_id = $li.find("input:hidden").val();
        var it_id2;
        var dup = false;
        $("#reg_item_list input[name='it_id[]']").each(function() {
            it_id2 = $(this).val();
            if(it_id == it_id2) {
                dup = true;
                return false;
            }
        });

        if(dup) {
            alert("이미 등록된 상품입니다.");
            return false;
        }

        var cont = "<li>"+$li.html().replace("add_item", "del_item").replace("추가", "삭제")+"</li>";
        var count = $("#reg_item_list li").size();

        if(count > 0) {
            $("#reg_item_list li:last").after(cont);
        } else {
            $("#reg_item_list").html("<ul>"+cont+"</ul>");
        }

        $li.remove();
    });

    $(document).on("click", "#reg_item_list .del_item", function() {
        if(!confirm("상품을 삭제하시겠습니까?"))
            return false;

        $(this).closest("li").remove();

        var count = $("#reg_item_list li").size();
        if(count < 1)
            $("#reg_item_list").html("<p>등록된 상품이 없습니다.</p>");
    });
});

function feventform_check(f) {
    var item = new Array();
    var ev_item = it_id = "";

    $("#reg_item_list input[name='it_id[]']").each(function() {
        it_id = $(this).val();
        if(it_id == "")
            return true;

        item.push(it_id);
    });

    if(item.length > 0)
        ev_item = item.join();

    $("input[name=ev_item]").val(ev_item);

    <!--{=get_editor_js('ev_head_html')}-->
    <!--{=get_editor_js('ev_tail_html')}-->

    return true;
}
</script>